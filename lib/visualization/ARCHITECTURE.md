# 数据可视化模块架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                     云效任务数据可视化模块 v2.0                    │
│                         (通用架构设计)                             │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                          配置层                                   │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  config.py                                              │     │
│  │  - 数据源路径                                            │     │
│  │  - 输出目录                                              │     │
│  │  - 图表样式配置 (尺寸/颜色/字体/DPI)                      │     │
│  │  - 任务类型映射                                          │     │
│  └────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                         工具层                                    │
│                                                                   │
│  ┌──────────────────────────┐    ┌──────────────────────────┐   │
│  │  visualizer.py           │    │  data_processor.py       │   │
│  │  (通用可视化工具)          │    │  (数据处理器)             │   │
│  ├──────────────────────────┤    ├──────────────────────────┤   │
│  │ • bar_chart()            │    │ • load_data()            │   │
│  │ • line_chart()           │    │ • parse_workdays()       │   │
│  │ • pie_chart()            │    │ • extract_task_type()    │   │
│  │ • stacked_bar_chart()    │    │ • get_project_workdays() │   │
│  │ • horizontal_bar_chart() │    │ • get_monthly_workdays() │   │
│  │ • heatmap()              │    │ • get_task_type_workdays()│  │
│  │ • multi_chart_dashboard()│    │ • get_top_tasks()        │   │
│  └──────────────────────────┘    │ • get_month_task_matrix()│   │
│          ↑                        │ • get_statistics()       │   │
│          │                        └──────────────────────────┘   │
│          │                                  ↑                     │
│          │                                  │                     │
└──────────┼──────────────────────────────────┼─────────────────────┘
           │                                  │
           │                                  │
┌──────────┼──────────────────────────────────┼─────────────────────┐
│          │         业务层                    │                     │
│          │                                  │                     │
│  ┌───────┴──────────────────────────────────┴────────────────┐   │
│  │  task_visualization.py                                    │   │
│  │  (云效任务数据可视化业务类)                                 │   │
│  ├───────────────────────────────────────────────────────────┤   │
│  │  • generate_project_chart()            # 项目人天统计      │   │
│  │  • generate_monthly_trend_chart()      # 月度趋势          │   │
│  │  • generate_task_type_chart()          # 任务类型占比      │   │
│  │  • generate_project_task_distribution()# 项目任务分布      │   │
│  │  • generate_top_tasks_chart()          # 任务排名          │   │
│  │  • generate_heatmap()                  # 热力图            │   │
│  │  • generate_dashboard()                # 综合仪表盘         │   │
│  │  • generate_basic_charts()             # 生成基础图表      │   │
│  │  • generate_advanced_charts()          # 生成高级图表      │   │
│  │  • generate_all_charts()               # 生成所有图表      │   │
│  └───────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                        应用层                                     │
│                                                                   │
│  ┌─────────────────────┐  ┌────────────────────┐                │
│  │ generate_charts.py  │  │ examples.py        │                │
│  │ (快速生成云效图表)   │  │ (通用工具示例)      │                │
│  └─────────────────────┘  └────────────────────┘                │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  用户自定义业务类                                          │   │
│  │  - 继承或组合 Visualizer                                   │   │
│  │  - 自定义数据处理逻辑                                       │   │
│  │  - 生成特定业务图表                                         │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                        输出层                                     │
│                                                                   │
│  output/                                                          │
│  ├── 项目人天统计_柱状图.png                                       │
│  ├── 月度人天趋势_折线图.png                                       │
│  ├── 任务类型占比_饼图.png                                        │
│  ├── 项目任务分布_堆积柱状图.png                                   │
│  ├── 任务人天排名_横向柱状图.png                                   │
│  ├── 月份任务类型_热力图.png                                      │
│  └── 综合统计仪表盘.png                                          │
└─────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════
                          数据流向
═══════════════════════════════════════════════════════════════════

┌──────────────┐
│ 原始数据源    │  (JSON/CSV/数据库等)
│ test_*.json  │
└──────┬───────┘
       │
       ↓
┌──────────────────┐
│ DataProcessor    │  加载和处理数据
│ - 数据清洗       │
│ - 数据聚合       │
│ - 数据转换       │
└──────┬───────────┘
       │
       ↓
┌──────────────────┐
│ 处理后的数据      │  字典、列表、矩阵等
│ {key: value}     │
└──────┬───────────┘
       │
       ↓
┌──────────────────┐
│ Visualizer       │  生成可视化
│ - 选择图表类型   │
│ - 应用样式配置   │
│ - 渲染图表       │
└──────┬───────────┘
       │
       ↓
┌──────────────────┐
│ 输出图片文件      │  PNG 格式
│ output/*.png     │
└──────────────────┘


═══════════════════════════════════════════════════════════════════
                        设计模式
═══════════════════════════════════════════════════════════════════

1. 分层架构 (Layered Architecture)
   - 配置层 → 工具层 → 业务层 → 应用层 → 输出层

2. 单一职责原则 (Single Responsibility)
   - Visualizer: 只负责可视化
   - DataProcessor: 只负责数据处理
   - TaskVisualization: 只负责业务组合

3. 依赖注入 (Dependency Injection)
   - 通过构造函数注入配置和依赖

4. 策略模式 (Strategy Pattern)
   - 不同的图表类型作为不同的策略

5. 工厂模式 (Factory Pattern)
   - Visualizer 作为图表工厂


═══════════════════════════════════════════════════════════════════
                        扩展性
═══════════════════════════════════════════════════════════════════

✅ 新增图表类型
   → 在 Visualizer 中添加新方法

✅ 新增数据源
   → 创建新的 DataProcessor 子类或实例

✅ 新增业务场景
   → 创建新的业务类,组合使用 Visualizer 和 DataProcessor

✅ 修改样式
   → 修改 config.py 中的配置

✅ 支持其他数据格式
   → 在 DataProcessor 中添加新的 load 方法
```
